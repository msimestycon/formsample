# üéØ BIZUIT Custom Form Template

> **Professional template for creating new custom forms**
> Based on recubiz-gestion design patterns and best practices

**Version**: 1.0.0
**Author**: Tycon S.A.
**License**: ISC

---

## üìã What's Included

This template provides a complete, production-ready structure for building BIZUIT custom forms:

‚úÖ **Professional UI** - Clean design with Bizuit UI Components
‚úÖ **SDK Integration** - Authentication, process calls, error handling
‚úÖ **Data Grid** - Sortable, filterable table with TanStack Table
‚úÖ **Form Controls** - Combo boxes, buttons, cards
‚úÖ **Dark Mode** - Full dark theme support
‚úÖ **TypeScript** - Type-safe development
‚úÖ **Fat Bundle** - Standalone dev.html for quick testing
‚úÖ **Best Practices** - Error handling, loading states, logging

---

## üöÄ Quick Start (5 Minutes)

### 1. Install Dependencies

```bash
# From form-template directory
npm install
```

### 2. Configure Environment

**Option A: Use Dev Credentials** (Recommended for local testing)

```bash
# In runtime-app/.env.local
ALLOW_DEV_MODE=true

# In runtime-app/dev-credentials.js
export const DEV_CREDENTIALS = {
  username: 'your.email@company.com',
  password: 'YourPassword123',
  apiUrl: 'https://test.bizuit.com/yourTenantBizuitDashboardapi/api/'
}
```

**Option B: Update Process Configuration**

Edit `src/index.tsx`:

```typescript
const SDK_CONFIG = {
  defaultApiUrl: 'https://test.bizuit.com/yourTenantBizuitDashboardapi/api/',
  processName: 'YourProcessName'  // ‚Üê Update this
};
```

### 3. Test with Fat Bundle (Fastest)

```bash
# Build fat bundle
npm run build

# Serve locally
cd dist
python3 -m http.server 8080

# Open in browser
open http://localhost:8080/dev.html
```

### 4. Test on Runtime (Production-like)

```bash
# Build form
npm run build

# Start runtime app (from project root)
cd ../../
./start-all.sh

# Upload ZIP via admin
open http://localhost:3001/admin/upload-forms
# Upload the generated ZIP from form-template/upload/

# Test form
open http://localhost:3001/form/form-template
```

---

## üìÅ Project Structure

```
form-template/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ index.tsx           # Main form component
‚îú‚îÄ‚îÄ dist/                   # Build output (generated)
‚îÇ   ‚îú‚îÄ‚îÄ form.js            # Fat bundle
‚îÇ   ‚îî‚îÄ‚îÄ dev.html           # Test page
‚îú‚îÄ‚îÄ upload/                 # Deployment ZIPs (generated by workflow)
‚îú‚îÄ‚îÄ package.json           # Dependencies and scripts
‚îú‚îÄ‚îÄ README.md              # This file
‚îî‚îÄ‚îÄ .env.example           # Environment variables example
```

---

## üèóÔ∏è Architecture

### Component Structure

```typescript
FormTemplate
‚îú‚îÄ‚îÄ BizuitThemeProvider    # Theme and i18n
‚îú‚îÄ‚îÄ Header                 # Title, version, user info
‚îú‚îÄ‚îÄ User Info Card         # Dashboard context (optional)
‚îú‚îÄ‚îÄ Loading State          # Spinner while loading
‚îú‚îÄ‚îÄ Error State            # Error message with retry
‚îî‚îÄ‚îÄ Main Content
    ‚îú‚îÄ‚îÄ Filters Section    # Combo box, action buttons
    ‚îú‚îÄ‚îÄ Data Grid Section  # TanStack Table with data
    ‚îî‚îÄ‚îÄ Actions Section    # Submit, cancel buttons
```

### Data Flow

```
1. Component Mounts
   ‚Üì
2. useEffect() triggers loadData()
   ‚Üì
3. SDK authenticates with Dashboard API
   ‚Üì
4. SDK calls process (raiseEvent)
   ‚Üì
5. Parse process response ‚Üí ExampleItem[]
   ‚Üì
6. Render data in BizuitDataGrid
   ‚Üì
7. User interactions (filter, sort, submit)
```

---

## üîß Customization Guide

### Step 1: Update SDK Configuration

```typescript
// src/index.tsx (lines 27-33)
const SDK_CONFIG = {
  defaultApiUrl: 'https://test.bizuit.com/yourTenantBizuitDashboardapi/api/',
  processName: 'YourActualProcessName'  // ‚Üê Change this
};
```

### Step 2: Define Your Data Types

```typescript
// src/index.tsx (lines 39-47)
interface YourDataItem {
  id: number;
  field1: string;
  field2: number;
  // ... your fields
}
```

### Step 3: Update Process Call

```typescript
// src/index.tsx (lines 95-104)
const result = await sdk.process.raiseEvent({
  processName: SDK_CONFIG.processName,
  activityName: 'YourActivityName',  // ‚Üê Update
  additionalParameters: sdk.process.createParameters([
    { name: 'pParam1', value: 'value1' },  // ‚Üê Your params
    { name: 'pParam2', value: 'value2' }
  ])
}, [], token);
```

### Step 4: Parse Response Data

```typescript
// src/index.tsx (lines 109-119)
const items: YourDataItem[] = result.parameters
  .filter(p => p.name === 'YourArrayParam')  // ‚Üê Update filter
  .map(p => ({
    id: p.value.id,           // ‚Üê Your field mapping
    field1: p.value.field1,
    field2: p.value.field2
  }));
```

### Step 5: Configure Data Grid Columns

```typescript
// src/index.tsx (lines 153-195)
const columns: ColumnDef<YourDataItem>[] = [
  {
    accessorKey: 'field1',
    header: 'Field 1 Header',
    size: 200,
  },
  {
    accessorKey: 'field2',
    header: 'Field 2 Header',
    size: 120,
    cell: ({ getValue }) => {
      // Custom cell rendering
      const value = getValue() as number;
      return <span>${value}</span>;
    }
  },
  // ... more columns
];
```

### Step 6: Update Styles and Branding

```typescript
// Header title
<h1 className="text-3xl font-bold text-slate-900 dark:text-white">
  Your Form Title  // ‚Üê Update
</h1>

// Color scheme (search and replace):
// orange-600 ‚Üí your-color-600
// orange-700 ‚Üí your-color-700
// etc.
```

---

## üíª Development Workflows

### Workflow 1: Fat Bundle (Recommended for UI Work)

**Use when**: Styling, layout, component testing

```bash
# Edit form
code src/index.tsx

# Build (fast - only your code)
npm run build

# Serve
cd dist && python3 -m http.server 8080

# Test
open http://localhost:8080/dev.html

# Iteration: Edit ‚Üí Build ‚Üí Refresh
```

**Pros**:
- ‚ö° Fast rebuilds (< 1 second)
- ‚ö° Instant browser refresh
- ‚ùå No backend needed
- ‚úÖ Perfect for UI iterations

**Cons**:
- ‚ùå Can't test real SDK calls
- ‚ùå Need mock data

### Workflow 2: Runtime Testing (Production-like)

**Use when**: SDK integration, process testing, final validation

```bash
# Build form
npm run build

# Start all services (from project root)
cd ../../
./start-all.sh

# Upload ZIP
open http://localhost:3001/admin/upload-forms

# Test form
open http://localhost:3001/form/form-template
```

**Pros**:
- ‚úÖ Tests real SDK calls
- ‚úÖ Tests database loading
- ‚úÖ Production-like behavior

**Cons**:
- üê¢ Slower (need upload each change)
- üê¢ Backend required

---

## üîë Environment Configuration

### Required Environment Variables

**File**: `runtime-app/.env.local` (in parent project)

```env
# ============================================================================
# Development Mode (CRITICAL for local testing)
# ============================================================================
# Allows forms to load without Dashboard token
ALLOW_DEV_MODE=true  # ‚Üê MUST be true for local development

# ============================================================================
# Dashboard API
# ============================================================================
# For local development (CORS proxy)
NEXT_PUBLIC_BIZUIT_DASHBOARD_API_URL=/api/bizuit

# For production (direct URL)
# NEXT_PUBLIC_BIZUIT_DASHBOARD_API_URL=https://test.bizuit.com/tenantBizuitDashboardapi/api

# ============================================================================
# Backend API
# ============================================================================
FASTAPI_URL=http://127.0.0.1:8000

# ============================================================================
# Session & Security
# ============================================================================
NEXT_PUBLIC_SESSION_TIMEOUT_MINUTES=30
WEBHOOK_SECRET=your-webhook-secret
```

### Development Credentials

**File**: `runtime-app/dev-credentials.js`

```javascript
export const DEV_CREDENTIALS = {
  username: 'your.email@company.com',
  password: 'YourDashboardPassword',
  apiUrl: 'https://test.bizuit.com/yourTenantBizuitDashboardapi/api/'
  //                                    ^^^^^^^^^^^^
  //                                    Your tenant name
}
```

**Tenant name examples**:
- `arielsch` ‚Üí `arielschBizuitDashboardapi`
- `recubiz` ‚Üí `recubizBizuitDashboardapi`
- Pattern: `{tenant}BizuitDashboardapi/api/`

---

## üß™ Testing

### Test Checklist

Before deploying:

- [ ] Form loads without errors (fat bundle)
- [ ] Data grid displays correctly (fat bundle)
- [ ] Filters work (fat bundle)
- [ ] SDK calls succeed (runtime testing)
- [ ] Process integration works (runtime testing)
- [ ] Form loads from database (runtime testing)
- [ ] Mobile responsive (browser DevTools)
- [ ] Dark mode works (theme toggle)
- [ ] No console errors (all scenarios)

### Common Issues

**Issue**: "Authentication failed"
```bash
# Check:
1. ALLOW_DEV_MODE=true in runtime-app/.env.local
2. dev-credentials.js exists and has correct values
3. API URL format: must end with /api/
```

**Issue**: "Process not found"
```typescript
// Update SDK_CONFIG.processName to match your actual process
const SDK_CONFIG = {
  processName: 'YourActualProcessName'  // Check spelling!
};
```

**Issue**: "Form not loading on port 3001"
```bash
# Remember: Port 3001 loads from DATABASE
# Steps:
1. npm run build
2. Upload ZIP via http://localhost:3001/admin
3. THEN test on http://localhost:3001/form/form-template
```

---

## üì¶ Deployment

### Automatic Deployment (GitHub Actions)

```bash
# 1. Commit your changes
git add form-template/
git commit -m "feat: add new form"

# 2. Push to main
git push origin main

# 3. GitHub Actions will:
#    - Build form
#    - Bump version
#    - Create deployment ZIP
#    - Upload to Artifacts
#    - Commit ZIP to repo
#    - Create git tag

# 4. Download artifact from GitHub Actions
# 5. Upload via admin panel
```

### Manual Deployment

```bash
# Build
npm run build

# Create ZIP
cd dist
zip -r ../form-template-deployment.zip .

# Upload via admin panel
open http://localhost:3001/admin/upload-forms
```

---

## üìö Additional Resources

- **Main Documentation**: `../../DEVELOPER_GUIDE.md`
- **Interactive Docs**: `http://localhost:3001/docs`
- **SDK Documentation**: `../../packages/bizuit-form-sdk/README.md`
- **UI Components**: `../../packages/bizuit-ui-components/README.md`

---

## üéì Next Steps

### For New Developers

1. **Week 1**: Understand the template
   - [ ] Read this README completely
   - [ ] Test fat bundle workflow
   - [ ] Explore the code structure
   - [ ] Understand SDK configuration

2. **Week 2**: Customize for your use case
   - [ ] Update SDK_CONFIG with your process
   - [ ] Define your data types
   - [ ] Update process call parameters
   - [ ] Configure data grid columns

3. **Week 3**: Add features
   - [ ] Add custom filters
   - [ ] Add validation
   - [ ] Add custom actions
   - [ ] Improve error handling

4. **Week 4**: Test and deploy
   - [ ] Test with fat bundle
   - [ ] Test on runtime (port 3001)
   - [ ] Deploy via GitHub Actions
   - [ ] Verify in production

---

## üí° Tips & Best Practices

### DO:
- ‚úÖ Use TypeScript for type safety
- ‚úÖ Handle loading and error states
- ‚úÖ Log important events to console
- ‚úÖ Use Bizuit UI Components (consistent design)
- ‚úÖ Test with fat bundle first (faster iteration)
- ‚úÖ Use semantic versioning in commits (feat:, fix:, chore:)

### DON'T:
- ‚ùå Hardcode API URLs (use SDK_CONFIG)
- ‚ùå Ignore error handling
- ‚ùå Skip loading states
- ‚ùå Commit sensitive credentials
- ‚ùå Manually change package.json version (let workflow handle it)

---

## üêõ Troubleshooting

### "Cannot find module '@tyconsa/bizuit-form-sdk'"

```bash
npm install
```

### "Process call failed"

```bash
# Check SDK_CONFIG.processName matches your actual process
# Check Dashboard API is accessible
# Check dev-credentials.js has correct values
```

### "Form not rendering"

```bash
# Check browser console for errors
# Verify React and UI components loaded
# Check BizuitThemeProvider is wrapping everything
```

### "Invalid author format" on Upload

```bash
# Error: Invalid author format: Tycon S.A.

# Cause: Backend validation doesn't allow spaces in author field

# Fix: Edit package.json
{
  "author": "Tyconsa"  // ‚úÖ No spaces
}

# NOT:
{
  "author": "Tycon SA"     // ‚ùå Has space
  "author": "Tycon S.A."   // ‚ùå Has space and dot
}

# Valid alternatives:
{
  "author": "Tycon-SA"     // ‚úÖ Hyphen
  "author": "Tycon_SA"     // ‚úÖ Underscore
  "author": "john.doe"     // ‚úÖ Dot allowed (no spaces)
}
```

---

## üìã Validation Rules Reference

### package.json Field Validation

The backend validates these fields with strict regex patterns:

| Field | Regex | Allows Spaces? | Example Valid | Example Invalid |
|-------|-------|----------------|---------------|-----------------|
| **author** | `^[a-zA-Z0-9._@-]+$` | ‚ùå No | `Tyconsa`, `john.doe` | `Tycon SA` |
| **name** | (flexible) | ‚úÖ Yes (in scope) | `@tyconsa/my-form` | - |
| **version** | `^\d+\.\d+\.\d+$` | ‚ùå No | `1.0.5` | `v1.0.0`, `1.0` |
| **description** | (no validation) | ‚úÖ Yes | Any text | - |

**Key Rules**:
- ‚ö†Ô∏è **author**: NO SPACES - use `Tyconsa`, `John-Doe`, or `admin@bizuit`
- ‚ö†Ô∏è **version**: Semantic versioning (MAJOR.MINOR.PATCH)
- ‚úÖ **description**: Free text, any format

**Why no spaces in author?**
Security validation (SQL injection, XSS, command injection prevention)

---

## üìû Need Help?

- **Documentation**: `http://localhost:3001/docs`
- **Team Support**: Ask your team lead or senior developer
- **Issues**: Check troubleshooting section above

---

**Happy coding!** üöÄ
